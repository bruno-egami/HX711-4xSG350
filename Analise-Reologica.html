<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisador de Reômetro Capilar</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        .parameters-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }
        
        .parameters-section h2 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 1.5em;
        }
        
        .parameters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .param-group {
            display: flex;
            flex-direction: column;
        }
        
        .param-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .param-group input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .param-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .data-section {
            margin-bottom: 30px;
        }
        
        .data-section h2 {
            color: #2c3e50;
            font-size: 1.5em;
            margin-bottom: 20px;
        }
        
        .data-input {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .data-input input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95em;
        }
        
        .data-input input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .add-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .results-table th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
        }
        
        .results-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .results-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .chart-container h3 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .regression-info {
            background: #e8f5e8;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #27ae60;
        }
        
        .regression-info h3 {
            color: #27ae60;
            margin-top: 0;
        }
        
        .regression-params {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .param-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .param-display .label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }
        
        .param-display .value {
            font-size: 1.2em;
            color: #27ae60;
            font-weight: 700;
            margin-top: 5px;
        }
        
        .clear-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-left: 10px;
        }
        
        .clear-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .equations-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            border-left: 5px solid #9b59b6;
        }
        
        .equations-section h3 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4em;
        }
        
        .equations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .equation {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #9b59b6;
        }
        
        .equation-title {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        
        .equation-formula {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            color: #9b59b6;
            font-weight: 600;
            margin-bottom: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .equation-desc {
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .parameters-grid {
                grid-template-columns: 1fr;
            }
            
            .data-input {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Analisador de Reômetro Capilar</h1>
            <p>Análise reológica com Lei da Potência</p>
        </div>
        
        <div class="content">
            <div class="parameters-section">
                <h2>Parâmetros do Equipamento</h2>
                <div class="parameters-grid">
                    <div class="param-group">
                        <label for="capillary-diameter">Diâmetro interno do capilar (mm):</label>
                        <input type="number" id="capillary-diameter" value="1.0" step="0.1">
                    </div>
                    <div class="param-group">
                        <label for="capillary-length">Comprimento do capilar (mm):</label>
                        <input type="number" id="capillary-length" value="30.0" step="0.1">
                    </div>
                    <div class="param-group">
                        <label for="material-density">Densidade do material (g/cm³):</label>
                        <input type="number" id="material-density" value="1.0" step="0.01">
                    </div>
                    <div class="param-group">
                        <label for="default-time">Tempo de extrusão padrão (s):</label>
                        <input type="number" id="default-time" value="60" step="1">
                    </div>
                </div>
            </div>
            
            <div class="data-section">
                <h2>Dados Experimentais</h2>
                <div class="data-input">
                    <input type="number" id="input-pressure" placeholder="Pressão (bar)" step="0.01">
                    <input type="number" id="input-mass" placeholder="Massa extrudada (g)" step="0.01">
                </div>
                <button class="add-btn" onclick="addDataPoint()">Adicionar Ponto</button>
                <button class="clear-btn" onclick="clearAllData()">Limpar Todos os Dados</button>
            </div>
            
            <table class="results-table" id="results-table">
                <thead>
                    <tr>
                        <th>Pressão (bar)</th>
                        <th>Massa (g)</th>
                        <th>Vazão (cm³/s)</th>
                        <th>Taxa de Cisalhamento (1/s)</th>
                        <th>Tensão de Cisalhamento (Pa)</th>
                        <th>Viscosidade (Pa·s)</th>
                        <th>log(Taxa)</th>
                        <th>log(Tensão)</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody id="results-body">
                </tbody>
            </table>
            
            <div class="charts-container">
                <div class="chart-container">
                    <h3>Gráfico log(τ) vs log(γ̇)</h3>
                    <canvas id="logChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Gráfico Tensão vs Taxa</h3>
                    <canvas id="linearChart"></canvas>
                </div>
            </div>
            
            <div class="regression-info">
                <h3>Análise da Lei da Potência: τ = K × γ̇ⁿ</h3>
                <div class="regression-params">
                    <div class="param-display">
                        <div class="label">Índice de Consistência (K)</div>
                        <div class="value" id="k-value">-</div>
                    </div>
                    <div class="param-display">
                        <div class="label">Índice de Comportamento (n)</div>
                        <div class="value" id="n-value">-</div>
                    </div>
                    <div class="param-display">
                        <div class="label">Coeficiente de Correlação (R²)</div>
                        <div class="value" id="r2-value">-</div>
                    </div>
                    <div class="param-display">
                        <div class="label">Erro Médio Quadrático</div>
                        <div class="value" id="rmse-value">-</div>
                    </div>
                </div>
                <div id="fluid-behavior" class="param-display" style="margin-top: 15px; grid-column: 1/-1;">
                    <div class="label">Comportamento do Fluido</div>
                    <div class="value" id="behavior-value" style="font-size: 1em; color: #2c3e50;">-</div>
                </div>
            </div>
            
            <div class="equations-section">
                <h3>Equações Utilizadas</h3>
                <div class="equations-grid">
                    <div class="equation">
                        <div class="equation-title">Vazão Volumétrica</div>
                        <div class="equation-formula">Q = (m / ρ) / t</div>
                        <div class="equation-desc">Q: vazão (cm³/s), m: massa (g), ρ: densidade (g/cm³), t: tempo (s)</div>
                    </div>
                    <div class="equation">
                        <div class="equation-title">Taxa de Cisalhamento</div>
                        <div class="equation-formula">γ̇ = 32Q / (πD³)</div>
                        <div class="equation-desc">γ̇: taxa de cisalhamento (1/s), D: diâmetro do capilar (cm)</div>
                    </div>
                    <div class="equation">
                        <div class="equation-title">Tensão de Cisalhamento</div>
                        <div class="equation-formula">τ = (P × D) / (4L)</div>
                        <div class="equation-desc">τ: tensão de cisalhamento (Pa), P: pressão (Pa), L: comprimento (cm)</div>
                    </div>
                    <div class="equation">
                        <div class="equation-title">Viscosidade</div>
                        <div class="equation-formula">η = τ / γ̇</div>
                        <div class="equation-desc">η: viscosidade (Pa·s)</div>
                    </div>
                    <div class="equation">
                        <div class="equation-title">Lei da Potência</div>
                        <div class="equation-formula">τ = K × γ̇ⁿ</div>
                        <div class="equation-desc">K: índice de consistência, n: índice de comportamento</div>
                    </div>
                    <div class="equation">
                        <div class="equation-title">Regressão Linear</div>
                        <div class="equation-formula">log(τ) = log(K) + n × log(γ̇)</div>
                        <div class="equation-desc">Linearização para determinação de K e n</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let dataPoints = [];
        let logChart, linearChart;

        function initializeCharts() {
            const logCtx = document.getElementById('logChart').getContext('2d');
            const linearCtx = document.getElementById('linearChart').getContext('2d');

            logChart = new Chart(logCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Dados Experimentais',
                        data: [],
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        pointRadius: 6
                    }, {
                        label: 'Regressão Linear',
                        data: [],
                        backgroundColor: 'rgba(231, 76, 60, 0.6)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 3,
                        pointRadius: 0,
                        type: 'line',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'log(Taxa de Cisalhamento)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'log(Tensão de Cisalhamento)'
                            }
                        }
                    }
                }
            });

            linearChart = new Chart(linearCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Dados Experimentais',
                        data: [],
                        backgroundColor: 'rgba(46, 204, 113, 0.6)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 2,
                        pointRadius: 6
                    }, {
                        label: 'Ajuste Lei da Potência',
                        data: [],
                        backgroundColor: 'rgba(155, 89, 182, 0.6)',
                        borderColor: 'rgba(155, 89, 182, 1)',
                        borderWidth: 3,
                        pointRadius: 0,
                        type: 'line',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Taxa de Cisalhamento (1/s)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Tensão de Cisalhamento (Pa)'
                            }
                        }
                    }
                }
            });
        }

        function addDataPoint() {
            const pressureElement = document.getElementById('input-pressure');
            const massElement = document.getElementById('input-mass');
            const timeElement = document.getElementById('default-time');

            if (!pressureElement || !massElement || !timeElement) {
                alert('Erro: Elementos não encontrados na página.');
                return;
            }

            const pressure = parseFloat(pressureElement.value);
            const mass = parseFloat(massElement.value);
            const time = parseFloat(timeElement.value);

            if (isNaN(pressure) || isNaN(mass) || isNaN(time)) {
                alert('Por favor, preencha todos os campos com valores válidos.');
                return;
            }

            const calculations = calculateValues(mass, time, pressure);
            dataPoints.push({
                pressure: pressure,
                mass: mass,
                time: time,
                ...calculations
            });

            updateTable();
            updateCharts();
            updateRegression();
            clearInputs();
        }

        function calculateValues(mass, time, pressure) {
            const diameterElement = document.getElementById('capillary-diameter');
            const lengthElement = document.getElementById('capillary-length');
            const densityElement = document.getElementById('material-density');
            
            if (!diameterElement || !lengthElement || !densityElement) {
                alert('Erro: Parâmetros do equipamento não encontrados.');
                return {};
            }

            const diameter = parseFloat(diameterElement.value) / 10; // mm para cm
            const length = parseFloat(lengthElement.value) / 10; // mm para cm
            const density = parseFloat(densityElement.value);

            if (isNaN(diameter) || isNaN(length) || isNaN(density)) {
                alert('Erro: Verifique os parâmetros do equipamento.');
                return {};
            }

            // Vazão volumétrica (cm³/s)
            const volumetricFlow = (mass / density) / time;

            // Taxa de cisalhamento (1/s)
            const shearRate = (32 * volumetricFlow) / (Math.PI * Math.pow(diameter, 3));

            // Tensão de cisalhamento (Pa)
            const shearStress = (pressure * 100000 * diameter) / (4 * length); // bar para Pa

            // Viscosidade (Pa·s)
            const viscosity = shearStress / shearRate;

            // Logaritmos
            const logShearRate = Math.log10(shearRate);
            const logShearStress = Math.log10(shearStress);

            return {
                volumetricFlow: volumetricFlow,
                shearRate: shearRate,
                shearStress: shearStress,
                viscosity: viscosity,
                logShearRate: logShearRate,
                logShearStress: logShearStress
            };
        }

        function updateTable() {
            const tbody = document.getElementById('results-body');
            tbody.innerHTML = '';

            dataPoints.forEach((point, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${point.pressure.toFixed(2)}</td>
                    <td>${point.mass.toFixed(2)}</td>
                    <td>${point.volumetricFlow.toFixed(4)}</td>
                    <td>${point.shearRate.toFixed(2)}</td>
                    <td>${point.shearStress.toFixed(2)}</td>
                    <td>${point.viscosity.toFixed(4)}</td>
                    <td>${point.logShearRate.toFixed(3)}</td>
                    <td>${point.logShearStress.toFixed(3)}</td>
                    <td><button class="clear-btn" onclick="removeDataPoint(${index})">Remover</button></td>
                `;
            });
        }

        function updateCharts() {
            if (dataPoints.length === 0) {
                logChart.data.datasets[0].data = [];
                logChart.data.datasets[1].data = [];
                linearChart.data.datasets[0].data = [];
                linearChart.data.datasets[1].data = [];
                logChart.update();
                linearChart.update();
                return;
            }

            // Atualizar gráfico logarítmico
            logChart.data.datasets[0].data = dataPoints.map(point => ({
                x: point.logShearRate,
                y: point.logShearStress
            }));

            // Atualizar gráfico linear
            linearChart.data.datasets[0].data = dataPoints.map(point => ({
                x: point.shearRate,
                y: point.shearStress
            }));

            logChart.update();
            linearChart.update();
        }

        function updateRegression() {
            const kElement = document.getElementById('k-value');
            const nElement = document.getElementById('n-value');
            const r2Element = document.getElementById('r2-value');
            const rmseElement = document.getElementById('rmse-value');
            const behaviorElement = document.getElementById('behavior-value');
            
            if (dataPoints.length < 2) {
                if (kElement) kElement.textContent = '-';
                if (nElement) nElement.textContent = '-';
                if (r2Element) r2Element.textContent = '-';
                if (rmseElement) rmseElement.textContent = '-';
                if (behaviorElement) behaviorElement.textContent = '-';
                return;
            }

            // Regressão linear nos dados logarítmicos
            const n = dataPoints.length;
            const sumX = dataPoints.reduce((sum, p) => sum + p.logShearRate, 0);
            const sumY = dataPoints.reduce((sum, p) => sum + p.logShearStress, 0);
            const sumXY = dataPoints.reduce((sum, p) => sum + p.logShearRate * p.logShearStress, 0);
            const sumX2 = dataPoints.reduce((sum, p) => sum + p.logShearRate * p.logShearRate, 0);
            const sumY2 = dataPoints.reduce((sum, p) => sum + p.logShearStress * p.logShearStress, 0);

            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;

            const nIndex = slope;
            const K = Math.pow(10, intercept);

            // Coeficiente de correlação
            const r = (n * sumXY - sumX * sumY) / Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            const r2 = r * r;

            // RMSE
            const predictions = dataPoints.map(p => slope * p.logShearRate + intercept);
            const rmse = Math.sqrt(dataPoints.reduce((sum, p, i) => sum + Math.pow(p.logShearStress - predictions[i], 2), 0) / n);

            // Avaliação do comportamento do fluido
            let behavior = '';
            let qualityAssessment = '';
            
            if (nIndex < 1) {
                behavior = `Fluido Pseudoplástico (n = ${nIndex.toFixed(3)} < 1)`;
            } else if (nIndex > 1) {
                behavior = `Fluido Dilatante (n = ${nIndex.toFixed(3)} > 1)`;
            } else {
                behavior = `Fluido Newtoniano (n ≈ 1)`;
            }
            
            if (r2 > 0.95) {
                qualityAssessment = ' - Excelente ajuste';
            } else if (r2 > 0.90) {
                qualityAssessment = ' - Bom ajuste';
            } else if (r2 > 0.80) {
                qualityAssessment = ' - Ajuste razoável';
            } else {
                qualityAssessment = ' - Ajuste fraco - Verificar dados';
            }
            
            behavior += qualityAssessment;

            // Atualizar display
            if (kElement) kElement.textContent = K.toFixed(3);
            if (nElement) nElement.textContent = nIndex.toFixed(3);
            if (r2Element) r2Element.textContent = r2.toFixed(4);
            if (rmseElement) rmseElement.textContent = rmse.toFixed(4);
            if (behaviorElement) behaviorElement.textContent = behavior;

            // Atualizar linha de regressão no gráfico logarítmico
            const minX = Math.min(...dataPoints.map(p => p.logShearRate));
            const maxX = Math.max(...dataPoints.map(p => p.logShearRate));
            logChart.data.datasets[1].data = [
                { x: minX, y: slope * minX + intercept },
                { x: maxX, y: slope * maxX + intercept }
            ];

            // Atualizar curva da Lei da Potência no gráfico linear
            const minShearRate = Math.min(...dataPoints.map(p => p.shearRate));
            const maxShearRate = Math.max(...dataPoints.map(p => p.shearRate));
            const curvePoints = [];
            for (let i = 0; i <= 100; i++) {
                const shearRate = minShearRate + (maxShearRate - minShearRate) * i / 100;
                const shearStress = K * Math.pow(shearRate, nIndex);
                curvePoints.push({ x: shearRate, y: shearStress });
            }
            linearChart.data.datasets[1].data = curvePoints;

            logChart.update();
            linearChart.update();
        }

        function removeDataPoint(index) {
            dataPoints.splice(index, 1);
            updateTable();
            updateCharts();
            updateRegression();
        }

        function clearAllData() {
            if (confirm('Tem certeza que deseja limpar todos os dados?')) {
                dataPoints = [];
                updateTable();
                updateCharts();
                updateRegression();
            }
        }

        function clearInputs() {
            const pressureElement = document.getElementById('input-pressure');
            const massElement = document.getElementById('input-mass');
            
            if (pressureElement) pressureElement.value = '';
            if (massElement) massElement.value = '';
        }

        // Inicializar gráficos quando a página carregar
        window.onload = function() {
            initializeCharts();
        };
    </script>
</body>
</html>